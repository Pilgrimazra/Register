<script>
const form = document.getElementById("registrationForm");
const messageBox = document.getElementById("formMessage");
const submitBtn = document.getElementById("submitBtn");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  // Reset message
  messageBox.textContent = "";
  messageBox.style.color = "#000";

  // Disable button
  submitBtn.disabled = true;
  submitBtn.textContent = "Saving...";

  // Get inputs safely
  const nameInput = document.getElementById("name").value.trim();
  const modelInput = document.getElementById("model").value.trim();
  const phoneInput = document.getElementById("phone").value.trim();
  const ram = document.getElementById("ram");
  const ssd = document.getElementById("ssd");
  const hdd = document.getElementById("hdd");

  /* -------- Validation -------- */
  if (!nameInput || !modelInput || !phoneInput) {
    messageBox.textContent = "Please fill in all required fields.";
    messageBox.style.color = "red";
    submitBtn.disabled = false;
    submitBtn.textContent = "Submit Registration";
    return;
  }

  const parts = [];

  if (ram.checked) {
    const ramSize = document.querySelector('input[name="ram_size"]:checked');
    if (!ramSize) {
      messageBox.textContent = "Please select RAM size.";
      messageBox.style.color = "red";
      submitBtn.disabled = false;
      submitBtn.textContent = "Submit Registration";
      return;
    }
    parts.push("RAM " + ramSize.value);
  }

  if (ssd.checked) {
    const ssdSize = document.querySelector('input[name="ssd_size"]:checked');
    if (!ssdSize) {
      messageBox.textContent = "Please select SSD size.";
      messageBox.style.color = "red";
      submitBtn.disabled = false;
      submitBtn.textContent = "Submit Registration";
      return;
    }
    parts.push("SSD " + ssdSize.value);
  }

  if (hdd.checked) {
    const hddSize = document.querySelector('input[name="hdd_size"]:checked');
    if (!hddSize) {
      messageBox.textContent = "Please select HDD size.";
      messageBox.style.color = "red";
      submitBtn.disabled = false;
      submitBtn.textContent = "Submit Registration";
      return;
    }
    parts.push("HDD " + hddSize.value);
  }

  /* -------- Data Object -------- */
  const now = new Date();
  const data = {
    receiptId: "DE-" + now.getTime(),
    owner: nameInput,
    model: modelInput,
    phone: phoneInput,
    parts: parts,
    registrationFee: 5000,
    date: now.toLocaleDateString(),
    time: now.toLocaleTimeString(),
    createdAt: now
  };

  /* -------- Firebase Save -------- */
  try {
    await window.saveToFirebase(data);

    messageBox.textContent = "✔ Registration saved successfully!";
    messageBox.style.color = "green";

    form.reset();
  } catch (error) {
    messageBox.textContent = "❌ Failed to save. Please try again.";
    messageBox.style.color = "red";
    console.error(error);
  }

  // Restore button
  submitBtn.disabled = false;
  submitBtn.textContent = "Submit Registration";
});
</script>
